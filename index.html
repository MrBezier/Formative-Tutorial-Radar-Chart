<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formative Feedback Radar Chart (Dark Mode)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #121212;  /* Dark background for dark mode */
            color: #e0e0e0;  /* Light text for dark mode */
        }
        .container {
            max-width: 100%;  /* Full width for the container */
            padding: 20px;
            box-sizing: border-box;
        }
        h2 {
            font-size: 1.8em;  /* Responsive title size */
            text-align: center;
            color: #ffffff;  /* White text for dark mode */
        }
        p {
            text-align: center;
            font-size: 1em;
            color: #cccccc;  /* Light grey text for dark mode */
        }
        .inputs {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 10px;
            justify-content: center;
        }
        .inputs label {
            flex: 1 1 45%;
            max-width: 200px;
            color: #e0e0e0;  /* Light text for inputs */
        }
        .inputs input {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #333;  /* Dark border for inputs */
            background-color: #333;  /* Dark background for inputs */
            color: #ffffff;  /* White text for inputs */
        }
        .chart-container {
            position: relative;
            width: 100%;  /* Full width for the chart container */
            height: auto;
            margin-top: 10px;  /* Reduced margin to bring the chart closer */
        }
        canvas {
            width: 100%;
            height: auto;  /* Let the height adjust automatically based on width */
        }
        button {
            display: block;
            width: 80%;
            max-width: 300px;
            margin: 10px auto;
            padding: 10px;
            font-size: 1.2em;
            background-color: #6200ea;  /* Purple background for dark mode button */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #3700b3;  /* Darker purple on hover */
        }
        @media (max-width: 768px) {
            h2 {
                font-size: 1.5em;  /* Smaller title size on tablets */
            }
            p {
                font-size: 0.9em;
            }
            .inputs label {
                flex: 1 1 90%;
                max-width: none;  /* Make inputs stack on smaller screens */
            }
        }
        @media (max-width: 480px) {
            h2 {
                font-size: 1.2em;  /* Smaller title size on phones */
            }
            p {
                font-size: 0.8em;
            }
            .inputs label {
                flex: 1 1 100%;  /* Full width inputs for phones */
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Formative Feedback Radar Chart</h2>
    <p>Enter percentages for each category (0% - 100%):</p>

    <!-- Input fields for dynamic values -->
    <div class="inputs">
        <label>Acquisition of Knowledge: <input type="number" id="knowledge" min="0" max="100" value="40"></label>
        <label>Development: <input type="number" id="development" min="0" max="100" value="40"></label>
        <label>Reflection: <input type="number" id="reflection" min="0" max="100" value="40"></label>
        <label>Resolution: <input type="number" id="resolution" min="0" max="100" value="40"></label>
        <label>Communication: <input type="number" id="communication" min="0" max="100" value="40"></label>
        <label>Engagement: <input type="number" id="engagement" min="0" max="100" value="40"></label>
    </div>

    <button onclick="downloadHighResImage()">Download</button>

    <!-- Chart container -->
    <div class="chart-container">
        <canvas id="radarChart"></canvas>
    </div>
</div>

<script>
    const canvas = document.getElementById('radarChart');
    const ctx = canvas.getContext('2d');
    canvas.width = canvas.parentElement.offsetWidth;  // Adjust width based on container
    canvas.height = canvas.width * 0.75;  // Keep the aspect ratio to prevent distortion

    // Categories and values
    const categories = ['Knowledge', 'Development', 'Reflection', 'Resolution', 'Communication', 'Engagement'];
    
    const maxValue = 100;  // Max value for the radar chart
    const radius = 200;    // Increased radius for wider canvas
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const angleStep = (Math.PI * 2) / categories.length;
    const rotationOffset = -Math.PI / 2;  // Rotate by 90 degrees to start "Knowledge" at the top

    // Function to generate random transparent color with 30% opacity
    function getRandomTransparentColor() {
        const r = Math.floor(Math.random() * 256);
        const g = Math.floor(Math.random() * 256);
        const b = Math.floor(Math.random() * 256);
        return `rgba(${r}, ${g}, ${b}, 0.3)`;  // 30% opacity
    }

    // Function to check if any input is less than or equal to 40
    function shouldUseGreyColor() {
        const values = [
            parseInt(document.getElementById('knowledge').value),
            parseInt(document.getElementById('development').value),
            parseInt(document.getElementById('reflection').value),
            parseInt(document.getElementById('resolution').value),
            parseInt(document.getElementById('communication').value),
            parseInt(document.getElementById('engagement').value),
        ];
        return values.some(value => value <= 40);  // Return true if any value is <= 40
    }

    // Draw radar chart on a given context
    function drawRadarChart(values, ctx, fillColor = 'rgba(54, 162, 235, 0.3)', labelColor = '#ffffff') {
        ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear the canvas before drawing

        // Draw the background circles (spiderweb)
        ctx.strokeStyle = '#ddd';
        for (let i = 0; i <= 5; i++) {
            const r = (radius / 5) * i;
            ctx.beginPath();
            ctx.arc(centerX, centerY, r, 0, Math.PI * 2);
            ctx.stroke();
        }

        // Draw category axes
        ctx.strokeStyle = '#bbb';
        for (let i = 0; i < categories.length; i++) {
            const angle = angleStep * i + rotationOffset;  // Apply rotation offset
            const x = centerX + Math.cos(angle) * radius;
            const y = centerY + Math.sin(angle) * radius;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        // Draw the radar shape (based on values)
        ctx.fillStyle = fillColor;  // Use the fillColor parameter with transparency
        ctx.strokeStyle = 'rgba(54, 162, 235, 1)';
        ctx.beginPath();
        for (let i = 0; i < values.length; i++) {
            const valueRatio = values[i] / maxValue;
            const angle = angleStep * i + rotationOffset;  // Apply rotation offset
            const x = centerX + Math.cos(angle) * radius * valueRatio;
            const y = centerY + Math.sin(angle) * radius * valueRatio;
            if (i === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        }
        ctx.closePath();
        ctx.fill();
        ctx.stroke();

        // Draw category labels with specific alignment
        ctx.fillStyle = labelColor;  // Set label color dynamically (white for browser, black for download)
        ctx.font = '18pt Arial';  // Set text to 18pt
        for (let i = 0; i < categories.length; i++) {
            const angle = angleStep * i + rotationOffset;  // Apply rotation offset
            const x = centerX + Math.cos(angle) * (radius + 50); // Adjust label position for wider canvas
            const y = centerY + Math.sin(angle) * (radius + 50); // Adjust label position
            
            // Set custom text alignment
            if (categories[i] === 'Knowledge' || categories[i] === 'Resolution') {
                ctx.textAlign = 'center'; // Center align
            } else if (categories[i] === 'Engagement' || categories[i] === 'Communication') {
                ctx.textAlign = 'right';  // Right align
            } else if (categories[i] === 'Development' || categories[i] === 'Reflection') {
                ctx.textAlign = 'left';   // Left align
            }
            ctx.fillText(categories[i], x, y);
        }
    }

    // Update chart based on input values and randomize fill color or set grey
    function updateChart() {
        const values = [
            parseInt(document.getElementById('knowledge').value),
            parseInt(document.getElementById('development').value),
            parseInt(document.getElementById('reflection').value),
            parseInt(document.getElementById('resolution').value),
            parseInt(document.getElementById('communication').value),
            parseInt(document.getElementById('engagement').value),
        ];

        // Check if any input is <= 40 to determine the fill color
        const fillColor = shouldUseGreyColor() ? 'rgba(169, 169, 169, 0.3)' : getRandomTransparentColor();  // Grey if <= 40
        drawRadarChart(values, ctx, fillColor, '#ffffff');  // White labels in the browser
    }

    // Add event listeners to update chart when values change
    document.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', updateChart);
    });

    // Draw initial radar chart
    updateChart();

    // Download high-resolution image
    function downloadHighResImage() {
        const exportCanvas = document.createElement('canvas');
        const exportCtx = exportCanvas.getContext('2d');

        // Set high resolution canvas size with proper aspect ratio
        const scaleFactor = 5;  // Scale by 5 for higher resolution
        const exportWidth = canvas.width * scaleFactor;
        const exportHeight = canvas.height * scaleFactor;

        exportCanvas.width = exportWidth;
        exportCanvas.height = exportHeight;

        // Redraw the chart on the high-resolution canvas
        const values = [
            parseInt(document.getElementById('knowledge').value),
            parseInt(document.getElementById('development').value),
            parseInt(document.getElementById('reflection').value),
            parseInt(document.getElementById('resolution').value),
            parseInt(document.getElementById('communication').value),
            parseInt(document.getElementById('engagement').value),
        ];

        const fillColor = shouldUseGreyColor() ? 'rgba(169, 169, 169, 0.3)' : getRandomTransparentColor();  // Grey if <= 40
        exportCtx.scale(scaleFactor, scaleFactor);  // Scale the context
        drawRadarChart(values, exportCtx, fillColor, '#000000');  // Black labels for the download

        // Convert to image and trigger download
        const link = document.createElement('a');
        link.href = exportCanvas.toDataURL('image/png', 1.0);  // Set high quality
        link.download = 'high-res-radar-chart.png';
        link.click();
    }
</script>

</body>
</html>
